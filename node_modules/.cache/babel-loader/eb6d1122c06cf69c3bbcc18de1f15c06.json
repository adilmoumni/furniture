{"ast":null,"code":"function ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nimport { checkRendering, createDocumentationMessageGenerator, warning, getRefinements, isEqual, noop } from '../../lib/utils';\nvar withUsage = createDocumentationMessageGenerator({\n  name: 'query-rules',\n  connector: true\n});\n\nfunction hasStateRefinements(state) {\n  return [state.disjunctiveFacetsRefinements, state.facetsRefinements, state.hierarchicalFacetsRefinements, state.numericRefinements].some(function (refinement) {\n    return Boolean(refinement && Object.keys(refinement).length > 0);\n  });\n} // A context rule must consist only of alphanumeric characters, hyphens, and underscores.\n// See https://www.algolia.com/doc/guides/managing-results/refine-results/merchandising-and-promoting/in-depth/implementing-query-rules/#context\n\n\nfunction escapeRuleContext(ruleName) {\n  return ruleName.replace(/[^a-z0-9-_]+/gi, '_');\n}\n\nfunction getRuleContextsFromTrackedFilters(_ref) {\n  var helper = _ref.helper,\n      sharedHelperState = _ref.sharedHelperState,\n      trackedFilters = _ref.trackedFilters;\n  var ruleContexts = Object.keys(trackedFilters).reduce(function (facets, facetName) {\n    var facetRefinements = getRefinements(helper.lastResults || {}, sharedHelperState, true).filter(function (refinement) {\n      return refinement.attribute === facetName;\n    }).map(function (refinement) {\n      return refinement.numericValue || refinement.name;\n    });\n    var getTrackedFacetValues = trackedFilters[facetName];\n    var trackedFacetValues = getTrackedFacetValues(facetRefinements);\n    return [].concat(_toConsumableArray(facets), _toConsumableArray(facetRefinements.filter(function (facetRefinement) {\n      return trackedFacetValues.includes(facetRefinement);\n    }).map(function (facetValue) {\n      return escapeRuleContext(\"ais-\".concat(facetName, \"-\").concat(facetValue));\n    })));\n  }, []);\n  return ruleContexts;\n}\n\nfunction applyRuleContexts(event) {\n  var helper = this.helper,\n      initialRuleContexts = this.initialRuleContexts,\n      trackedFilters = this.trackedFilters,\n      transformRuleContexts = this.transformRuleContexts;\n  var sharedHelperState = event.state;\n  var previousRuleContexts = sharedHelperState.ruleContexts || [];\n  var newRuleContexts = getRuleContextsFromTrackedFilters({\n    helper: helper,\n    sharedHelperState: sharedHelperState,\n    trackedFilters: trackedFilters\n  });\n  var nextRuleContexts = [].concat(_toConsumableArray(initialRuleContexts), _toConsumableArray(newRuleContexts));\n  process.env.NODE_ENV === 'development' ? warning(nextRuleContexts.length <= 10, \"\\nThe maximum number of `ruleContexts` is 10. They have been sliced to that limit.\\nConsider using `transformRuleContexts` to minimize the number of rules sent to Algolia.\\n\") : void 0;\n  var ruleContexts = transformRuleContexts(nextRuleContexts).slice(0, 10);\n\n  if (!isEqual(previousRuleContexts, ruleContexts)) {\n    helper.overrideStateWithoutTriggeringChangeEvent(_objectSpread(_objectSpread({}, sharedHelperState), {}, {\n      ruleContexts: ruleContexts\n    }));\n  }\n}\n\nvar connectQueryRules = function connectQueryRules(_render) {\n  var unmount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n  checkRendering(_render, withUsage());\n  return function (widgetParams) {\n    var _ref2 = widgetParams || {},\n        _ref2$trackedFilters = _ref2.trackedFilters,\n        trackedFilters = _ref2$trackedFilters === void 0 ? {} : _ref2$trackedFilters,\n        _ref2$transformRuleCo = _ref2.transformRuleContexts,\n        transformRuleContexts = _ref2$transformRuleCo === void 0 ? function (rules) {\n      return rules;\n    } : _ref2$transformRuleCo,\n        _ref2$transformItems = _ref2.transformItems,\n        transformItems = _ref2$transformItems === void 0 ? function (items) {\n      return items;\n    } : _ref2$transformItems;\n\n    Object.keys(trackedFilters).forEach(function (facetName) {\n      if (typeof trackedFilters[facetName] !== 'function') {\n        throw new Error(withUsage(\"'The \\\"\".concat(facetName, \"\\\" filter value in the `trackedFilters` option expects a function.\")));\n      }\n    });\n    var hasTrackedFilters = Object.keys(trackedFilters).length > 0; // We store the initial rule contexts applied before creating the widget\n    // so that we do not override them with the rules created from `trackedFilters`.\n\n    var initialRuleContexts = [];\n    var onHelperChange;\n    return {\n      $$type: 'ais.queryRules',\n      init: function init(initOptions) {\n        var helper = initOptions.helper,\n            state = initOptions.state,\n            instantSearchInstance = initOptions.instantSearchInstance;\n        initialRuleContexts = state.ruleContexts || [];\n        onHelperChange = applyRuleContexts.bind({\n          helper: helper,\n          initialRuleContexts: initialRuleContexts,\n          trackedFilters: trackedFilters,\n          transformRuleContexts: transformRuleContexts\n        });\n\n        if (hasTrackedFilters) {\n          // We need to apply the `ruleContexts` based on the `trackedFilters`\n          // before the helper changes state in some cases:\n          //   - Some filters are applied on the first load (e.g. using `configure`)\n          //   - The `transformRuleContexts` option sets initial `ruleContexts`.\n          if (hasStateRefinements(state) || Boolean(widgetParams.transformRuleContexts)) {\n            onHelperChange({\n              state: state\n            });\n          } // We track every change in the helper to override its state and add\n          // any `ruleContexts` needed based on the `trackedFilters`.\n\n\n          helper.on('change', onHelperChange);\n        }\n\n        _render(_objectSpread(_objectSpread({}, this.getWidgetRenderState(initOptions)), {}, {\n          instantSearchInstance: instantSearchInstance\n        }), true);\n      },\n      render: function render(renderOptions) {\n        var instantSearchInstance = renderOptions.instantSearchInstance;\n\n        _render(_objectSpread(_objectSpread({}, this.getWidgetRenderState(renderOptions)), {}, {\n          instantSearchInstance: instantSearchInstance\n        }), false);\n      },\n      getWidgetRenderState: function getWidgetRenderState(_ref3) {\n        var results = _ref3.results;\n\n        var _ref4 = results || {},\n            _ref4$userData = _ref4.userData,\n            userData = _ref4$userData === void 0 ? [] : _ref4$userData;\n\n        var items = transformItems(userData);\n        return {\n          items: items,\n          widgetParams: widgetParams\n        };\n      },\n      getRenderState: function getRenderState(renderState, renderOptions) {\n        return _objectSpread(_objectSpread({}, renderState), {}, {\n          queryRules: this.getWidgetRenderState(renderOptions)\n        });\n      },\n      dispose: function dispose(_ref5) {\n        var helper = _ref5.helper,\n            state = _ref5.state;\n        unmount();\n\n        if (hasTrackedFilters) {\n          helper.removeListener('change', onHelperChange);\n          return state.setQueryParameter('ruleContexts', initialRuleContexts);\n        }\n\n        return state;\n      }\n    };\n  };\n};\n\nexport default connectQueryRules;","map":{"version":3,"sources":["/Users/adil/Documents/GitHub/furniture-front/node_modules/instantsearch.js/es/connectors/query-rules/connectQueryRules.js"],"names":["ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","configurable","writable","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","o","minLen","_arrayLikeToArray","n","prototype","toString","call","slice","constructor","name","Array","from","test","iter","Symbol","iterator","isArray","len","arr2","checkRendering","createDocumentationMessageGenerator","warning","getRefinements","isEqual","noop","withUsage","connector","hasStateRefinements","state","disjunctiveFacetsRefinements","facetsRefinements","hierarchicalFacetsRefinements","numericRefinements","some","refinement","Boolean","escapeRuleContext","ruleName","replace","getRuleContextsFromTrackedFilters","_ref","helper","sharedHelperState","trackedFilters","ruleContexts","reduce","facets","facetName","facetRefinements","lastResults","attribute","map","numericValue","getTrackedFacetValues","trackedFacetValues","concat","facetRefinement","includes","facetValue","applyRuleContexts","event","initialRuleContexts","transformRuleContexts","previousRuleContexts","newRuleContexts","nextRuleContexts","process","env","NODE_ENV","overrideStateWithoutTriggeringChangeEvent","connectQueryRules","_render","unmount","undefined","widgetParams","_ref2","_ref2$trackedFilters","_ref2$transformRuleCo","rules","_ref2$transformItems","transformItems","items","Error","hasTrackedFilters","onHelperChange","$$type","init","initOptions","instantSearchInstance","bind","on","getWidgetRenderState","render","renderOptions","_ref3","results","_ref4","_ref4$userData","userData","getRenderState","renderState","queryRules","dispose","_ref5","removeListener","setQueryParameter"],"mappings":"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","sourcesContent":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport { checkRendering, createDocumentationMessageGenerator, warning, getRefinements, isEqual, noop } from '../../lib/utils';\nvar withUsage = createDocumentationMessageGenerator({\n  name: 'query-rules',\n  connector: true\n});\n\nfunction hasStateRefinements(state) {\n  return [state.disjunctiveFacetsRefinements, state.facetsRefinements, state.hierarchicalFacetsRefinements, state.numericRefinements].some(function (refinement) {\n    return Boolean(refinement && Object.keys(refinement).length > 0);\n  });\n} // A context rule must consist only of alphanumeric characters, hyphens, and underscores.\n// See https://www.algolia.com/doc/guides/managing-results/refine-results/merchandising-and-promoting/in-depth/implementing-query-rules/#context\n\n\nfunction escapeRuleContext(ruleName) {\n  return ruleName.replace(/[^a-z0-9-_]+/gi, '_');\n}\n\nfunction getRuleContextsFromTrackedFilters(_ref) {\n  var helper = _ref.helper,\n      sharedHelperState = _ref.sharedHelperState,\n      trackedFilters = _ref.trackedFilters;\n  var ruleContexts = Object.keys(trackedFilters).reduce(function (facets, facetName) {\n    var facetRefinements = getRefinements(helper.lastResults || {}, sharedHelperState, true).filter(function (refinement) {\n      return refinement.attribute === facetName;\n    }).map(function (refinement) {\n      return refinement.numericValue || refinement.name;\n    });\n    var getTrackedFacetValues = trackedFilters[facetName];\n    var trackedFacetValues = getTrackedFacetValues(facetRefinements);\n    return [].concat(_toConsumableArray(facets), _toConsumableArray(facetRefinements.filter(function (facetRefinement) {\n      return trackedFacetValues.includes(facetRefinement);\n    }).map(function (facetValue) {\n      return escapeRuleContext(\"ais-\".concat(facetName, \"-\").concat(facetValue));\n    })));\n  }, []);\n  return ruleContexts;\n}\n\nfunction applyRuleContexts(event) {\n  var helper = this.helper,\n      initialRuleContexts = this.initialRuleContexts,\n      trackedFilters = this.trackedFilters,\n      transformRuleContexts = this.transformRuleContexts;\n  var sharedHelperState = event.state;\n  var previousRuleContexts = sharedHelperState.ruleContexts || [];\n  var newRuleContexts = getRuleContextsFromTrackedFilters({\n    helper: helper,\n    sharedHelperState: sharedHelperState,\n    trackedFilters: trackedFilters\n  });\n  var nextRuleContexts = [].concat(_toConsumableArray(initialRuleContexts), _toConsumableArray(newRuleContexts));\n  process.env.NODE_ENV === 'development' ? warning(nextRuleContexts.length <= 10, \"\\nThe maximum number of `ruleContexts` is 10. They have been sliced to that limit.\\nConsider using `transformRuleContexts` to minimize the number of rules sent to Algolia.\\n\") : void 0;\n  var ruleContexts = transformRuleContexts(nextRuleContexts).slice(0, 10);\n\n  if (!isEqual(previousRuleContexts, ruleContexts)) {\n    helper.overrideStateWithoutTriggeringChangeEvent(_objectSpread(_objectSpread({}, sharedHelperState), {}, {\n      ruleContexts: ruleContexts\n    }));\n  }\n}\n\nvar connectQueryRules = function connectQueryRules(_render) {\n  var unmount = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : noop;\n  checkRendering(_render, withUsage());\n  return function (widgetParams) {\n    var _ref2 = widgetParams || {},\n        _ref2$trackedFilters = _ref2.trackedFilters,\n        trackedFilters = _ref2$trackedFilters === void 0 ? {} : _ref2$trackedFilters,\n        _ref2$transformRuleCo = _ref2.transformRuleContexts,\n        transformRuleContexts = _ref2$transformRuleCo === void 0 ? function (rules) {\n      return rules;\n    } : _ref2$transformRuleCo,\n        _ref2$transformItems = _ref2.transformItems,\n        transformItems = _ref2$transformItems === void 0 ? function (items) {\n      return items;\n    } : _ref2$transformItems;\n\n    Object.keys(trackedFilters).forEach(function (facetName) {\n      if (typeof trackedFilters[facetName] !== 'function') {\n        throw new Error(withUsage(\"'The \\\"\".concat(facetName, \"\\\" filter value in the `trackedFilters` option expects a function.\")));\n      }\n    });\n    var hasTrackedFilters = Object.keys(trackedFilters).length > 0; // We store the initial rule contexts applied before creating the widget\n    // so that we do not override them with the rules created from `trackedFilters`.\n\n    var initialRuleContexts = [];\n    var onHelperChange;\n    return {\n      $$type: 'ais.queryRules',\n      init: function init(initOptions) {\n        var helper = initOptions.helper,\n            state = initOptions.state,\n            instantSearchInstance = initOptions.instantSearchInstance;\n        initialRuleContexts = state.ruleContexts || [];\n        onHelperChange = applyRuleContexts.bind({\n          helper: helper,\n          initialRuleContexts: initialRuleContexts,\n          trackedFilters: trackedFilters,\n          transformRuleContexts: transformRuleContexts\n        });\n\n        if (hasTrackedFilters) {\n          // We need to apply the `ruleContexts` based on the `trackedFilters`\n          // before the helper changes state in some cases:\n          //   - Some filters are applied on the first load (e.g. using `configure`)\n          //   - The `transformRuleContexts` option sets initial `ruleContexts`.\n          if (hasStateRefinements(state) || Boolean(widgetParams.transformRuleContexts)) {\n            onHelperChange({\n              state: state\n            });\n          } // We track every change in the helper to override its state and add\n          // any `ruleContexts` needed based on the `trackedFilters`.\n\n\n          helper.on('change', onHelperChange);\n        }\n\n        _render(_objectSpread(_objectSpread({}, this.getWidgetRenderState(initOptions)), {}, {\n          instantSearchInstance: instantSearchInstance\n        }), true);\n      },\n      render: function render(renderOptions) {\n        var instantSearchInstance = renderOptions.instantSearchInstance;\n\n        _render(_objectSpread(_objectSpread({}, this.getWidgetRenderState(renderOptions)), {}, {\n          instantSearchInstance: instantSearchInstance\n        }), false);\n      },\n      getWidgetRenderState: function getWidgetRenderState(_ref3) {\n        var results = _ref3.results;\n\n        var _ref4 = results || {},\n            _ref4$userData = _ref4.userData,\n            userData = _ref4$userData === void 0 ? [] : _ref4$userData;\n\n        var items = transformItems(userData);\n        return {\n          items: items,\n          widgetParams: widgetParams\n        };\n      },\n      getRenderState: function getRenderState(renderState, renderOptions) {\n        return _objectSpread(_objectSpread({}, renderState), {}, {\n          queryRules: this.getWidgetRenderState(renderOptions)\n        });\n      },\n      dispose: function dispose(_ref5) {\n        var helper = _ref5.helper,\n            state = _ref5.state;\n        unmount();\n\n        if (hasTrackedFilters) {\n          helper.removeListener('change', onHelperChange);\n          return state.setQueryParameter('ruleContexts', initialRuleContexts);\n        }\n\n        return state;\n      }\n    };\n  };\n};\n\nexport default connectQueryRules;"]},"metadata":{},"sourceType":"module"}