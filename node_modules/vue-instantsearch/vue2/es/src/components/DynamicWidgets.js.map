{"version":3,"file":"DynamicWidgets.js","sources":["../../../../src/components/DynamicWidgets.js"],"sourcesContent":["import { createWidgetMixin } from '../mixins/widget';\nimport { connectDynamicWidgets } from 'instantsearch.js/es/connectors';\nimport { createSuitMixin } from '../mixins/suit';\nimport { _objectSpread } from '../util/polyfills';\nimport { isVue3, renderCompat, getDefaultSlot } from '../util/vue-compat';\n\nfunction getWidgetAttribute(vnode) {\n  const props = isVue3\n    ? vnode.props\n    : vnode.componentOptions && vnode.componentOptions.propsData;\n  if (props) {\n    if (props.attribute) {\n      return props.attribute;\n    }\n    if (Array.isArray(props.attributes)) {\n      return props.attributes[0];\n    }\n  }\n\n  let children;\n  if (isVue3) {\n    children =\n      vnode.children && vnode.children.default && vnode.children.default();\n  } else {\n    children =\n      vnode.componentOptions && vnode.componentOptions.children\n        ? vnode.componentOptions.children\n        : vnode.children;\n  }\n\n  if (Array.isArray(children)) {\n    // return first child with a truthy attribute\n    return children.reduce(\n      (acc, curr) => acc || getWidgetAttribute(curr),\n      undefined\n    );\n  }\n\n  return undefined;\n}\n\nexport default {\n  name: 'AisExperimentalDynamicWidgets',\n  mixins: [\n    createWidgetMixin({ connector: connectDynamicWidgets }),\n    createSuitMixin({ name: 'DynamicWidgets' }),\n  ],\n  props: {\n    transformItems: {\n      type: Function,\n      default: undefined,\n    },\n  },\n  render: renderCompat(function(h) {\n    const components = new Map();\n\n    (getDefaultSlot(this) || []).forEach(vnode => {\n      const attribute = getWidgetAttribute(vnode);\n      if (attribute) {\n        components.set(\n          attribute,\n          h('div', { key: attribute, class: [this.suit('widget')] }, [vnode])\n        );\n      }\n    });\n\n    // by default, render everything, but hidden so that the routing doesn't disappear\n    if (!this.state) {\n      const allComponents = [];\n      components.forEach(component => allComponents.push(component));\n\n      return h(\n        'div',\n        _objectSpread(\n          {\n            class: [this.suit()],\n          },\n          { attrs: { hidden: true } }\n        ),\n        allComponents\n      );\n    }\n\n    return h(\n      'div',\n      { class: [this.suit()] },\n      this.state.attributesToRender.map(attribute => components.get(attribute))\n    );\n  }),\n  computed: {\n    widgetParams() {\n      return {\n        transformItems: this.transformItems,\n        // we do not pass \"widgets\" to the connector, since Vue is in charge of rendering\n        widgets: [],\n      };\n    },\n  },\n};\n"],"names":["name","mixins","createWidgetMixin","connector","connectDynamicWidgets","createSuitMixin","props","transformItems","type","Function","default","undefined","render","renderCompat","h","components","Map","getDefaultSlot","this","forEach","vnode","const","attribute","getWidgetAttribute","children","componentOptions","propsData","Array","isArray","attributes","reduce","acc","curr","set","key","class","suit","state","allComponents","component","push","_objectSpread","attrs","hidden","attributesToRender","map","get","computed","widgetParams","widgets"],"mappings":"mVAyCe,CACbA,KAAM,gCACNC,OAAQ,CACNC,EAAkB,CAAEC,UAAWC,IAC/BC,EAAgB,CAAEL,KAAM,oBAE1BM,MAAO,CACLC,eAAgB,CACdC,KAAMC,SACNC,aAASC,IAGbC,OAAQC,EAAa,SAASC,cACtBC,EAAa,IAAIC,IAavB,IAXCC,EAAeC,OAAS,IAAIC,iBAAQC,GACnCC,IAAMC,EAnDZ,SAASC,EAAmBH,GAC1BC,IAYIG,EAZElB,EAEFc,EAAMK,kBAAoBL,EAAMK,iBAAiBC,UACrD,GAAIpB,EAAO,CACT,GAAIA,EAAMgB,UACR,OAAOhB,EAAMgB,UAEf,GAAIK,MAAMC,QAAQtB,EAAMuB,YACtB,OAAOvB,EAAMuB,WAAW,GAe5B,GANEL,EACEJ,EAAMK,kBAAoBL,EAAMK,iBAAiBD,SAC7CJ,EAAMK,iBAAiBD,SACvBJ,EAAMI,SAGVG,MAAMC,QAAQJ,GAEhB,OAAOA,EAASM,gBACbC,EAAKC,UAASD,GAAOR,EAAmBS,SACzCrB,GAuBkBY,CAAmBH,GACjCE,GACFP,EAAWkB,IACTX,EACAR,EAAE,MAAO,CAAEoB,IAAKZ,EAAWa,MAAO,CAACjB,EAAKkB,KAAK,YAAc,CAAChB,QAM7DF,KAAKmB,MAAO,CACfhB,IAAMiB,EAAgB,GAGtB,OAFAvB,EAAWI,iBAAQoB,UAAaD,EAAcE,KAAKD,KAE5CzB,EACL,MACA2B,EACE,CACEN,MAAO,CAACjB,KAAKkB,SAEf,CAAEM,MAAO,CAAEC,QAAQ,KAErBL,GAIJ,OAAOxB,EACL,MACA,CAAEqB,MAAO,CAACjB,KAAKkB,SACflB,KAAKmB,MAAMO,mBAAmBC,aAAIvB,UAAaP,EAAW+B,IAAIxB,QAGlEyB,SAAU,CACRC,wBACE,MAAO,CACLzC,eAAgBW,KAAKX,eAErB0C,QAAS"}